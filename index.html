<html>

<head>
    <title>Pranav Raman CS416 Visualiztion Project</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://unpkg.com/d3-svg-annotation@2.5.1/d3-annotation.min.js"></script>
</head>

<body>
    <div id="entirebody" style="display: flex; flex-direction: column; align-items: center; overflow: scroll;">
        <div style="justify-content: center; align-items: center; align-self: center; text-align: center;   
                        border: 1px solid #ccc;
                        border-radius: 8px;
                        padding: 10px 15px;
                        width: fit-content;
                        background-color: #f9f9f9;">
            <h1>What Affects Life Expectancy?</h1>
            <p>By Pranav Raman</p>
        </div>

        <p style="max-width: 700px; margin: 20px auto; text-align: center; font-size: 18px;">
            Life Expectancy is something that varies across the world. This visualization looks at different factors
            that affect life expectancy. This looks at the relationship between life expectancy and GDP healthcare
            spending, life expectancy vs adult mortality, life expectancy vs education/schooling,
            and life expectency vs vaccine coverage (Polio & Diphteria). The main message is that life expectancy is
            affected by many factors, and that the relationship between these factors and life expectancy is complex.

            Please click each button to see the different relationships and keep a lookout for annotations.
        </p>



        <div id="navBtnContainer" style="display: flex; gap: 20px; justify-content: center; margin-bottom: 20px;">
            <button class="button1"
                style="background-color: #1976d2; color: #fff; border: none; border-radius: 6px; padding: 10px 22px; font-size: 18px; font-family: inherit; cursor: pointer; transition: background 0.2s, transform 0.1s; box-shadow: 0 2px 6px rgba(25,118,210,0.08);"
                onmouseover="this.style.backgroundColor='#1565c0';this.style.transform='translateY(-2px) scale(1.05)';"
                onmouseout="this.style.backgroundColor='#1976d2';this.style.transform='none';"
                onmousedown="this.style.backgroundColor='#0d47a1';this.style.transform='scale(0.98)';"
                onmouseup="this.style.backgroundColor='#1565c0';this.style.transform='translateY(-2px) scale(1.05)';">1</button>
            <button class="button2"
                style="background-color: #1976d2; color: #fff; border: none; border-radius: 6px; padding: 10px 22px; font-size: 18px; font-family: inherit; cursor: pointer; transition: background 0.2s, transform 0.1s; box-shadow: 0 2px 6px rgba(25,118,210,0.08);"
                onmouseover="this.style.backgroundColor='#1565c0';this.style.transform='translateY(-2px) scale(1.05)';"
                onmouseout="this.style.backgroundColor='#1976d2';this.style.transform='none';"
                onmousedown="this.style.backgroundColor='#0d47a1';this.style.transform='scale(0.98)';"
                onmouseup="this.style.backgroundColor='#1565c0';this.style.transform='translateY(-2px) scale(1.05)';">2</button>
            <button class="button3"
                style="background-color: #1976d2; color: #fff; border: none; border-radius: 6px; padding: 10px 22px; font-size: 18px; font-family: inherit; cursor: pointer; transition: background 0.2s, transform 0.1s; box-shadow: 0 2px 6px rgba(25,118,210,0.08);"
                onmouseover="this.style.backgroundColor='#1565c0';this.style.transform='translateY(-2px) scale(1.05)';"
                onmouseout="this.style.backgroundColor='#1976d2';this.style.transform='none';"
                onmousedown="this.style.backgroundColor='#0d47a1';this.style.transform='scale(0.98)';"
                onmouseup="this.style.backgroundColor='#1565c0';this.style.transform='translateY(-2px) scale(1.05)';">3</button>
            <button class="button4"
                style="background-color: #1976d2; color: #fff; border: none; border-radius: 6px; padding: 10px 22px; font-size: 18px; font-family: inherit; cursor: pointer; transition: background 0.2s, transform 0.1s; box-shadow: 0 2px 6px rgba(25,118,210,0.08);"
                onmouseover="this.style.backgroundColor='#1565c0';this.style.transform='translateY(-2px) scale(1.05)';"
                onmouseout="this.style.backgroundColor='#1976d2';this.style.transform='none';"
                onmousedown="this.style.backgroundColor='#0d47a1';this.style.transform='scale(0.98)';"
                onmouseup="this.style.backgroundColor='#1565c0';this.style.transform='translateY(-2px) scale(1.05)';">4</button>
        </div>
        <h3 id="slideTitle" style="display:flex; justify-content: center; align-items: center; "></h3>

        <p id="slideDescription" style="display:flex; justify-content: center; align-items: center; "></p>

        <div id="chartContainer"
            style="display: flex; justify-content: center; flex-wrap: wrap; width: 100%; max-width: 1200px; margin: 0 auto;">
            <svg width=600 height=600>
            </svg>
            <div id="infoBox" style="margin-left: 30px; width: 200px; font-family: sans-serif;">
                <h3>Legend</h3>
                <div id="Legend" style="
                        border: 1px solid #ccc;
                        border-radius: 8px;
                        padding: 10px 15px;
                        width: fit-content;
                        background-color: #f9f9f9;
                        font-family: sans-serif;
                        font-size: 14px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        margin-top: 10px;
                    ">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                        <div style="width: 12px; height: 12px; background-color: green; border-radius: 50%;"></div>
                        <span>Developed Countries</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 12px; height: 12px; background-color: blue; border-radius: 50%;"></div>
                        <span>Developing Countries</span>
                    </div>
                </div>
                <h3>Country Info</h3>
                <div id="infoContent" style="
                        border: 1px solid #ccc;
                        border-radius: 8px;
                        padding: 10px 15px;
                        width: fit-content;
                        background-color: #f9f9f9;
                        font-family: sans-serif;
                        font-size: 14px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        margin-top: 10px;
                    ">>Hover over a point</div>
            </div>
        </div>


        <script>

            var slideTitles = {
                "PERCENTAGE_EXPENDITURE": "Life Expectancy vs % of GDP Spent On Healthcare",
                "ADULT_MORTALITY": "Life Expectancy vs Adult Mortality Rate",
                "SCHOOLING": "Life Expectancy vs Average Schooling (Years)",
                "VACCINATION_PERCENTAGE": "Life Expectancy vs Average Vaccination Coverage (%)"
            }
            var slideDescriptions = {
                "PERCENTAGE_EXPENDITURE": "This slide shows the relationship between life expectancy and the percentage of GDP spent on healthcare. ",
                "ADULT_MORTALITY": "This slide shows the relationship between life expectancy and adult mortality rate.",
                "SCHOOLING": "This slide shows the relationship between life expectancy and average schooling completed in years.",
                "VACCINATION_PERCENTAGE": "This slide shows the relationship between life expectancy and average vaccination coverage."
            }
            var dataFieldsCleaned = {
                "PERCENTAGE_EXPENDITURE": "% of GDP Spent On Healthcare",
                "LIFE_EXPECTANCY": "Life Expectancy (Years)",
                "ALCOHOL": "Alcohol Consumption per capita (liters)",
                "SCHOOLING": "Average Schooling Completed (Years)",
                "VACCINATION_PERCENTAGE": "Average Vaccination Coverage (%)",
                "ADULT_MORTALITY": "Adult Mortality Rate (per 1000 people)",
                "STATUS": "Country Development Status (Developed/Developing)"
            }
            var annotationText = {
                "PERCENTAGE_EXPENDITURE": "Countries that spend more on healthcare tend to have higher life expectancy. However, this isn't exactly a linear relationship. Countries that spend less seem to also have higher life expectancy which indicate other factors in play",
                "ADULT_MORTALITY": "Countries with higher adult mortality rates tend to have lower life expectancy. Maybe this is due to early/unnatural deaths decreasing the average.",
                "SCHOOLING": "Countries with higher average schooling seem to be highly correlated with having higher life expectancy. Due to education being a factor in health literacy, this makes sense.",
                "VACCINATION_PERCENTAGE": "Countries with higher vaccination coverage tend to have higher life expectancy."
            }
            var annotationPosition = {
                "PERCENTAGE_EXPENDITURE": { x: 0.95, y: 0.5 },
                "ADULT_MORTALITY": { x: 0.8, y: 0.1 },
                "SCHOOLING": { x: 0.9, y: 0.6 },
                "VACCINATION_PERCENTAGE": { x: 0.5, y: 0.05 }
            }

            d3.csv("./data/CLEANED_LIFE_EXPECTANCY_2014_FILLED.csv").then(function (data) {
                function drawChart(xVariable, yVariable) {
                    d3.select("svg").selectAll("*").remove();
                    d3.select("#infoContent").html("Hover over a point");
                    d3.select("#slideTitle").text(slideTitles[xVariable]);
                    d3.select("#slideDescription").text(slideDescriptions[xVariable]);
                    var margin = { top: 50, right: 50, bottom: 70, left: 60 };
                    var width = 600 - margin.left - margin.right;
                    var height = 600 - margin.top - margin.bottom;
                    var x = d3.scaleLinear()
                        .domain(d3.extent(data, d => +d[xVariable]))
                        .range([0, width]);
                    var y = d3.scaleLinear()
                        .domain(d3.extent(data, d => +d[yVariable]))
                        .range([height, 0]);
                    d3.select("svg").append("g").attr("transform", `translate(${margin.left},${margin.top})`).call(d3.axisLeft(y));
                    d3.select("svg").append("g").attr("transform", `translate(${margin.left},${600 - margin.bottom})`).call(d3.axisBottom(x));
                    d3.select("svg").append("text")
                        .attr("transform", `translate(${width / 2 + margin.left}, ${height + margin.top + 40})`)
                        .style("text-anchor", "middle")
                        .text(dataFieldsCleaned[xVariable]);
                    d3.select("svg").append("text")
                        .attr("transform", `translate(${margin.left - 40}, ${height / 2 + margin.top}) rotate(-90)`)
                        .style("text-anchor", "middle")
                        .text("Life Expectancy (Years)");
                    d3.select("svg").append("g").attr("transform", `translate(${margin.left},${margin.top})`)
                        .selectAll("circle")
                        .data(data)
                        .enter()
                        .append("circle")
                        .attr("cx", d => x(+d[xVariable]))
                        .attr("cy", d => y(+d[yVariable]))
                        .attr("r", 5)
                        .attr("fill", function (data, event) {
                            if (data["STATUS"] === "Developed") {
                                return "green";
                            } else if (data["STATUS"] === "Developing") {
                                return "blue";
                            } else {
                                return "red";
                            }
                        })
                        .on("mouseover", function (data, event) {
                            console.log(data);
                            d3.select(this).attr("fill", "orange");
                            d3.select("svg").append("text")
                                .attr("x", x(+data[xVariable]) + margin.left)
                                .attr("y", y(+data[yVariable]) + margin.top - 10)
                                .attr("class", "tooltip")
                                .attr("z-index", 500)
                                .text(`${data["COUNTRY"]}`);
                            d3.select("#infoContent").html(`
                                <strong>Country:</strong> ${data["COUNTRY"]}<br>
                                <strong>${dataFieldsCleaned[xVariable]}:</strong> ${(+data[xVariable]).toFixed(2)}<br>
                                <strong>${dataFieldsCleaned[yVariable]}:</strong> ${(+data[yVariable]).toFixed(2)}<br>
                                `);
                        }).on("mouseout", function (data, event) {
                            if (data["STATUS"] === "Developed") {
                                d3.select(this).attr("fill", "green");
                            } else if (data["STATUS"] === "Developing") {
                                d3.select(this).attr("fill", "blue");
                            } else {
                                d3.select(this).attr("fill", "red");
                            }
                            d3.select("svg").selectAll(".tooltip").remove();
                        });
                    d3.select("svg").selectAll(".annotation-group").remove();
                    const annotations = [{
                        note: {
                            label: annotationText[xVariable],
                            title: dataFieldsCleaned[xVariable],
                            wrap: 180,
                            align: "middle",
                            color: "red",
                        },
                        x: annotationPosition[xVariable].x * width,
                        y: annotationPosition[xVariable].y * height,
                        dy: 20,
                        dx: 0
                    }];

                    const makeAnnotations = d3.annotation()
                        .annotations(annotations);

                    d3.select("svg")
                        .append("g")
                        .attr("class", "annotation-group")
                        .call(makeAnnotations);
                    d3.select(".annotation-connector").remove();
                }
                drawChart("PERCENTAGE_EXPENDITURE", "LIFE_EXPECTANCY");
                d3.select(".button1").on("click", function () {
                    drawChart("PERCENTAGE_EXPENDITURE", "LIFE_EXPECTANCY");
                });
                d3.select(".button2").on("click", function () {
                    drawChart("ADULT_MORTALITY", "LIFE_EXPECTANCY");
                });
                d3.select(".button3").on("click", function () {
                    drawChart("SCHOOLING", "LIFE_EXPECTANCY");
                });
                d3.select(".button4").on("click", function () {
                    drawChart("VACCINATION_PERCENTAGE", "LIFE_EXPECTANCY");
                });

            });
        </script>
    </div>
</body>

</html>